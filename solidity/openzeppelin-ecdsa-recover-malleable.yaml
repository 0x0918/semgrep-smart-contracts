rules:
 -
    id: openzeppelin-ecdsa-recover-malleable
    message: potentially vulnerable to the signature replay attack due to CVE-2022-35961
    metadata:
        category: logic
    pattern-either:
    - pattern: |
         function $X(..., bytes $Y, ...) {
            ...
            $Z = ECDSA.recover(..., $Y);
            ...
            $A[$Y] = ...;
            ...
         }
    - pattern: |
         function $X(bytes $Y, ...) {
            ...
            $Z = ECDSA.recover(..., $Y);
            ...
            $A[$Y] = ...;
            ...
         }
    - pattern: |
         function $X(..., bytes $Y) {
            ...
            $Z = ECDSA.recover(..., $Y);
            ...
            $A[$Y] = ...;
            ...
         }
    - pattern: |
         function $X(..., bytes $Y, ...) {
            ...
            $Z = ECDSA.recover(..., $Y);
            ...
            $A[$B][$Y] = ...;
            ...
         }
    - pattern: |
         function $X(bytes $Y, ...) {
            ...
            $Z = ECDSA.recover(..., $Y);
            ...
            $A[$B][$Y] = ...;
            ...
         }
    - pattern: |
         function $X(..., bytes $Y) {
            ...
            $Z = ECDSA.recover(..., $Y);
            ...
            $A[$B][$Y] = ...;
            ...
         }
    languages: 
    - solidity
    severity: ERROR
